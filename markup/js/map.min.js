document.addEventListener("touchstart",function(){},!0),$(document).ready(function(){var a,b,c={strokeColor:"#0000ff",fillColor:"#8080ff",interactivityModel:"default#transparent",strokeWidth:4,opacity:.7},d={strokeStyle:"#0000ff",lineWidth:4,opacity:.7};ymaps.ready(["Map","geoQuery"]).then(function(){function e(a){var c=$('<li><a href="#">'+a.name+a.image+"</a></li>"),d=new ymaps.GeoObjectCollection(null,{preset:a.style}),e=$('<ul class="submenu"/>');b.geoObjects.add(d),c.append(e).appendTo(menu).find("a").bind("click",function(){d.getParent()?(b.geoObjects.remove(d),e.hide()):(b.geoObjects.add(d),e.show())});for(var g=0,h=a.items.length;h>g;g++)f(a.items[g],d,e)}function f(a,c,d){var e=$('<li><a href="#">'+a.image+"<div class='title'>"+a.name+a.description+"</div></a></li>"),f=new ymaps.Placemark(a.center,{balloonContent:"<div class='header_balloon'>"+a.image+"<div class='title'>"+a.rating+a.name+a.description+"</div>"+a.address+"</div>"},{balloonMinHeight:235,balloonMaxWidth:255,balloonMaxHeight:235,balloonOffset:[53,265],hideIconOnBalloonOpen:!1});b.geoObjects.add(f),c.add(f),f.events.add("mouseenter",function(a){a.get("target").options.set("preset","islands#redIcon")}).add("mouseleave",function(a){a.get("target").options.unset("preset")}),e.appendTo(d).find("a").bind("click",function(){return f.balloon.isOpen()?(f.balloon.close(),$(this).removeClass("active")):(f.balloon.open(),$(this).addClass("active")),!1}),b.geoObjects.add(c),b.geoObjects.add(f)}function g(a){var b=document.querySelector("#draw-canvas"),c=b.getContext("2d"),e=!1,f=[],g=a.container.getParentElement().getBoundingClientRect();return b.style.width=g.width+"px",b.style.height=g.height+"px",b.width=g.width,b.height=g.height,c.strokeStyle=d.strokeStyle,c.lineWidth=d.lineWidth,b.style.opacity=d.opacity,c.clearRect(0,0,b.width,b.height),b.style.display="block",b.onmousedown=function(a){e=!0,f.push([a.offsetX,a.offsetY])},b.onmousemove=function(a){if(e){var b=f[f.length-1];c.beginPath(),c.moveTo(b[0],b[1]),c.lineTo(a.offsetX,a.offsetY),c.stroke(),f.push([a.offsetX,a.offsetY])}},new Promise(function(a){b.onmouseup=function(c){f.push([c.offsetX,c.offsetY]),b.style.display="none",e=!1,f=f.map(function(a){return[a[0]/b.width,a[1]/b.height]}),a(f)}})}b=new ymaps.Map("map",{center:[55.75,37.62],zoom:9,controls:[]});var h=new ymaps.GeoObjectCollection({},{preset:"islands#redCircleIcon",strokeWidth:4,geodesic:!0,visible:!0});b.geoObjects.add(h),a=ymaps.geoQuery(h),a=ymaps.geoQuery(groups),menu=$('<ul class="menu"/>');for(var i=0,j=groups.length;j>i;i++)e(groups[i]);menu.appendTo($("#visible")),b.setBounds(b.geoObjects.getBounds());var k=ymaps.geoQuery(b.geoObjects);a=ymaps.geoQuery(k);var l=null,m=document.querySelector("#draw");m.onclick=function(){g(b).then(function(a){var d=b.getBounds();a=a.map(function(a){return[d[0][0]+(1-a[1])*(d[1][0]-d[0][0]),d[0][1]+a[0]*(d[1][1]-d[0][1])]}),a=a.filter(function(a,b){return b%3===0}),l&&b.geoObjects.remove(l),l=new ymaps.Polygon([a],{},c),b.geoObjects.add(l),l.options.setParent(b.options),l.geometry.setMap(b);var e=k.searchInside(l);e.setOptions("preset","islands#redIcon")})}})["catch"](console.error)});